<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Painel de Uso — Picornavirus-quali2026</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="hero">
      <div>
        <p class="eyebrow">WSL/Ubuntu • Picornavirus-quali2026</p>
        <h1>Painel de Uso (UX)</h1>
        <p class="subtitle">
          Interface simples para executar o pipeline com poucos cliques, mantendo logs claros e
          rastreáveis para qualificação.
        </p>
      </div>
      <div class="hero__card">
        <h2>Como acessar</h2>
        <ol>
          <li>Inicie o painel no WSL.</li>
          <li>Abra o navegador no Windows.</li>
          <li>Visite <strong>http://localhost:8000</strong>.</li>
        </ol>
        <p class="hint">Dica: mantenha este terminal aberto enquanto o painel estiver em uso.</p>
      </div>
    </header>

    <main>
      <div class="tabs">
        <button class="tab active" data-tab="tab-execucao">Execução</button>
        <button class="tab" data-tab="tab-historico">Histórico</button>
      </div>

      <section id="tab-execucao" class="tab-panel active">
        <section class="card">
          <div class="card__header">
            <h2>1) Verificar ambiente</h2>
            <p>Confirma se todas as dependências do pipeline estão instaladas.</p>
          </div>
          <button class="primary" data-action="check_env">Rodar check de ambiente</button>
        </section>

        <section class="card">
          <div class="card__header">
            <h2>2) Gerar DEMO reprodutível</h2>
            <p>Cria FASTQs de demonstração em <code>data/raw</code> para testes rápidos.</p>
          </div>
          <button class="primary" data-action="demo">Gerar DEMO</button>
        </section>

        <section class="card">
          <div class="card__header">
            <h2>3) Importar amostras reais</h2>
            <p>Informe os caminhos de R1/R2 (pode ser caminho do Windows).</p>
          </div>
          <form id="import-form" class="form-grid">
            <label>
              Nome da amostra
              <input name="sample" placeholder="Ex.: 81554_S150" list="samples" required />
            </label>
            <label>
              Caminho R1
              <input name="r1" placeholder="Ex.: C:\\dados\\amostra_R1.fastq.gz" required />
            </label>
            <label>
              Caminho R2
              <input name="r2" placeholder="Ex.: C:\\dados\\amostra_R2.fastq.gz" required />
            </label>
            <label class="checkbox">
              <input type="checkbox" name="copy" />
              Copiar arquivos (em vez de criar symlink)
            </label>
            <button class="primary" type="submit">Importar amostra</button>
          </form>
          <datalist id="samples"></datalist>
        </section>

        <section class="card">
          <div class="card__header">
            <h2>4) Rodar pipeline</h2>
            <p>Velvet é o padrão. SPAdes está disponível se <code>config.env</code> estiver configurado.</p>
          </div>
          <form id="pipeline-form" class="form-grid">
            <label>
              Nome da amostra
              <input name="sample" placeholder="Ex.: DEMO" list="samples" required />
            </label>
            <label>
              Assembler
              <select name="assembler">
                <option value="velvet">Velvet (padrão)</option>
                <option value="spades">SPAdes (requer config.env)</option>
              </select>
            </label>
            <label>
              k-mer (Velvet)
              <input name="kmer" type="number" min="15" max="99" value="31" />
            </label>
            <button class="primary" type="submit">Executar pipeline</button>
          </form>
        </section>

        <section class="card">
          <div class="card__header">
            <h2>5) Saída e logs</h2>
            <p>Acompanhe o progresso das execuções. Logs completos ficam em <code>logs/</code>.</p>
          </div>
          <div class="status">
            <div>
              <span class="status__label">Status atual</span>
              <strong id="job-status">Aguardando ação</strong>
            </div>
            <div>
              <span class="status__label">Última execução</span>
              <strong id="job-action">-</strong>
            </div>
          </div>
          <div class="pipeline-progress" id="pipeline-progress" hidden>
            <h3>Etapas do pipeline</h3>
            <ul>
              <li data-stage="host"><span class="stage-icon">⏳</span> Remoção de hospedeiro</li>
              <li data-stage="assembly"><span class="stage-icon">⏳</span> Montagem</li>
              <li data-stage="blast"><span class="stage-icon">⏳</span> BLAST</li>
            </ul>
          </div>
          <div id="final-status" class="final-status"></div>
          <pre id="job-output" class="log"></pre>
          <div class="report-viewer" id="report-viewer" hidden>
            <h3>Resumo do resultado (results/reports/*_summary.md)</h3>
            <pre id="report-content" class="report-content"></pre>
          </div>
        </section>
      </section>

      <section id="tab-historico" class="tab-panel">
        <section class="card">
          <div class="card__header">
            <h2>Histórico de execuções</h2>
            <p>Runs persistidos em <code>results/runs/*/run.json</code> com links rápidos para artefatos.</p>
          </div>
          <div id="history-list" class="history-list"></div>
        </section>
      </section>
    </main>

    <footer>
      <p>
        Painel de uso local • Picornavirus-quali2026 • dados gerados permanecem em <code>data/</code>,
        <code>results/</code> e <code>logs/</code>.
      </p>
    </footer>

    <script src="/app.js"></script>
  </body>
</html>
